# Хранение секретов в CI/CD и на сервере

## На сервере (production / staging)

- **Единственный источник секретов приложения:** файл **`.env`** в корне проекта (вне репозитория).
- В `.env` задаются: `APP_ENV`, `APP_DEBUG`, `APP_BASE_URL`, `APP_DEFAULT_LANG`, `YANDEX_METRIC_ID`, ключи API и т.д.
- Файл не коммитится (в `.gitignore`), не должен отдаваться веб-сервером: DocumentRoot указывает на **public/**.
- При ошибочной настройке корневой `.htaccess` запрещает доступ к `.env`.
- Передача на сервер: вручную (SFTP, SCP) или через защищённый канал деплоя; не хранить в открытом виде в репозитории и чатах.

## В CI/CD (GitHub Actions и др.)

- Секреты (API-ключи, токены деплоя, переменные для сборки) хранить в **Secrets** окружения или репозитория:
  - **GitHub:** Settings → Secrets and variables → Actions → Repository secrets (или Environment secrets).
- В workflow использовать `secrets.SECRET_NAME`, не подставлять значения в лог.
- Не выводить секреты в `echo` и не писать в артефакты, доступные публично.
- Для деплоя на хост: использовать SSH-ключ или токен, сохранённый в Secrets; ключ не коммитить.

## Резюме

| Где    | Что хранить                   | Как не утекает                          |
| ------ | ----------------------------- | --------------------------------------- |
| Сервер | `.env` с APP\_\*, ключами     | Не в репо, DocumentRoot = public/       |
| CI/CD  | Secrets репозитория/окружения | Только через `secrets.*`, не логировать |

Подробнее про чеклист выкатки: [deploy-checklist.md](deploy-checklist.md).
