# Правила организации и нейминга JavaScript в проекте

Соглашения по структуре файлов, именованию переменных/функций, работе с DOM и интеграции с HTML/CSS. Согласовано с [html-naming.md](html-naming.md) и [css-naming.md](css-naming.md).

---

## 1. Структура каталогов и файлов

Исходники в `assets/js/`, точка входа — `main.js`. Импорты разбиты по слоям:

| Каталог         | Назначение                                                      | Примеры файлов                                                            |
| --------------- | --------------------------------------------------------------- | ------------------------------------------------------------------------- |
| **base/**       | Инициализация, утилиты, общие зависимости                       | `init.js`, `expose-vendors.js`, `debounce-throttle.js`                    |
| **sections/**   | Логика секций страницы (шапка, подвал, intro, cookie-panel)     | `header.js`, `footer.js`, `intro.js`, `burger-menu.js`, `cookie-panel.js` |
| **components/** | Переиспользуемые компоненты (форма, аккордеон, слайдер, кнопка) | `accordion.js`, `form-callback/index.js`, `slider.js`, `button.js`        |
| **pages/**      | Логика, специфичная для конкретной страницы                     | `index.js`, `contacts.js`, `restaurants.js`, `404.js`                     |
| **utils/**      | Вспомогательные функции без привязки к DOM                      | `utm.js`                                                                  |

**Правило:** один блок (секция или компонент) — один модуль. Имя файла в **kebab-case** и совпадает с именем блока/секции: компонент `form-callback` → `components/form-callback/index.js` (при нескольких файлах — папка + `index.js`).

---

## 2. Селекторы и работа с DOM

### JS-хуки (классы `js-*`)

- Элементы, с которыми взаимодействует JS, помечаются классом с префиксом **`js-`** (см. [html-naming.md](html-naming.md)).
- В коде селекторы привязывать к **`js-*`**, а не к презентационным классам, чтобы изменение стилей не ломало скрипты.
- Примеры: `.js-header`, `.js-form-callback`, `.js-cookie`, `.js-burger`.

### Идентификаторы (`id`)

- Для уникальных UI-элементов используется **camelCase**: `introSlider`, `burgerIcon`, `formCallbackPhone`.
- Селектор по id — только когда элемент действительно один на странице (слайдер, форма с уникальным id). Для повторяющихся блоков — классы `js-*`.

### Data-атрибуты

- Имена в **kebab-case**: `data-settings`, `data-label-open`, `data-tags`.
- Данные для компонента передавать через `data-*`; при необходимости парсить JSON из атрибута с проверкой и обработкой ошибок (см. `slider.js`).

### Поиск внутри контейнера

- Поиск выполнять от корня компонента/секции (переданного элемента), а не от `document`, чтобы код работал при нескольких экземплярах на странице.
- Пример: `formElement.querySelector('[name="phone"]')`, `accordion.querySelectorAll('.accordion__item')`.

---

## 3. Именование переменных и функций

### Стиль

- **camelCase** для переменных, функций, методов, свойств объектов.
- **UPPER_SNAKE_CASE** для констант (в т.ч. экспортируемых): `API_TIMEOUT_MS`, `DEFAULT_LANG`, `COUNTRY_CODES`.
- Имена — на английском; комментарии и сообщения пользователю — допустимы на русском.

### Функции инициализации

- Публичная точка входа компонента — глагол или `init*` / `setup*`: `initCallbackForms()`, `setupSliders()`.
- Внутренние (приватные) функции — с префиксом **`_`** в классах: `_handleSubmit`, `_buildFormData`, `_setCurrentUrl`.
- Колбэки для событий — понятные имена: `_boundHandleSubmit`, `handleClick`, либо анонимная функция, если логика однострочная.

### Классы (ES6)

- Имя класса — **PascalCase**, по смыслу компонента: `CallbackForm`, `FormUI`, `FormValidator`, `PhoneMask`.
- Экспорт: при одном главном классе/функции — `export class Name` или `export function initName`; вспомогательные — именованный `export`.

---

## 4. Модули и импорты

- Использовать **ES-модули** (`import` / `export`).
- Порядок импортов в файле: сначала внешние/базовые, затем локальные (например, `../base/init.js`, затем `./api.js`).
- Инициализация по готовности DOM — через **`onReady(fn)`** из `base/init.js`, а не дублирование `DOMContentLoaded`.
- В `main.js` порядок: vendor → base → sections → components → pages → вызов `onReady` с запуском инициализаторов.

---

## 5. События и доступность

- Обработчики — через **addEventListener**; для снятия — **removeEventListener** (при `destroy()` или размонтировании).
- Предотвращение стандартного поведения — **`event.preventDefault()`** там, где нужно (отправка формы, клик по ссылке-действию).
- Для интерактивных компонентов (аккордеон, бургер-меню) обновлять **ARIA-атрибуты**: `aria-expanded`, `aria-controls`, `aria-label`, `aria-live`, чтобы поведение совпадало с состоянием для скринридеров.

---

## 6. Глобальные объекты и конфиг

- Конфигурация, общая для всего приложения, передаётся из Twig в **`window.appConfig`** (baseUrl, langCode, id метрик и т.д.). В коде проверять наличие перед использованием.
- Глобальные данные для компонентов (например, тексты формы) — **`window.globalData`**; ключи совпадают с именами компонентов в **kebab-case**: `window.globalData['form-callback']`.
- Утилиты, нужные извне (например, из инлайнов в шаблоне), вешаются на **`window`** явно: `window.url`, `window.initCallbackForms`.

---

## 7. Ошибки и консоль

- Критичные ошибки (нет зависимости, не найден обязательный элемент) — **`console.error`** с понятным текстом.
- Парсинг JSON из `data-*` и ответы API — в **try/catch**; при ошибке — логировать и не ломать остальной код (fallback: пустой объект, дефолтные настройки).

---

## 8. Форматы данных на границе с бэкендом/шаблоном

- Имена полей формы, ключи в `FormData`, ключи в JSON ответах API — **snake_case** или **kebab-case** в зависимости от контракта API (в проекте для форм часто: `current_url`, `csrf_token`, `request_id`).
- Языковой код — два символа: `lang_code` / `lang` (ru, en); использовать единую функцию разрешения языка (например, `resolveLang`) и константу `DEFAULT_LANG`.

---

## Краткая шпаргалка

| Сущность            | Формат / правило                                                                |
| ------------------- | ------------------------------------------------------------------------------- |
| Файлы/папки         | kebab-case; один блок — один модуль; компонент с подмодулями — папка + index.js |
| Селекторы в JS      | По классам `js-*`; по id только для уникальных элементов (camelCase)            |
| data-\*             | kebab-case                                                                      |
| Переменные, функции | camelCase                                                                       |
| Константы           | UPPER_SNAKE_CASE                                                                |
| Классы              | PascalCase                                                                      |
| Приватные методы    | Префикс `_`                                                                     |
| Инициализация DOM   | onReady() из base/init.js                                                       |
| Глобальный конфиг   | window.appConfig; данные компонентов — window.globalData['component-name']      |
